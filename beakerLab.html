<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Inter:wght@500&family=Rubik+Bubbles&display=swap');
        @font-face {
            font-family: 'Kyuri_diary';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/naverfont_07@1.0/Kyuri_diary.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        body{
            margin: 0;
            padding: 0;
            background-image: url('./image/beakerLabBack.png'); /* 식탁이 있는 부엌 배경 이미지 */
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* 배경 이미지를 고정시킴 */
            height: 100vh;
            overflow: hidden; /* 페이지의 내용이 넘치지 않도록 함 */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        

        .child {
            width: 400px;
            height: 500px;
            padding: 1rem;
        }

        .absolute {
            position: absolute;
            bottom: 50px;
            left: 0;
        }
        .beaker_container{
            position: absolute;
            width: 300px;
            height: 270px;
            top: 33%;
            left: 13%;
        }
        #beaker_back{
            background-image: url("./image/plask_back_blue1.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            transition: all 0.2s;
        }
        #beaker_cover{
            background-image: url("./image/plask_blue1.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            transition: all 0.2s;
        }
        .opac_5 {
            opacity: 0.5;
        }
        #singerBox1{
            background-image: url("./image/standD.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 150px;
            height: 160px;
            position: absolute;
            top: 450px;
            right: 24px;
            transition: background-image 0.1s ease;
            cursor: pointer;
        }
        #singerBox2{
            background-image: url("./image/standM.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 150px;
            height: 160px;
            position: absolute;
            top:405px;
            left: 64px;
            transition: background-image 0.1s ease;
            cursor: pointer;
        }
        #singerBox3{    
            background-image: url("./image/standR.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 120px;
            height: 180px;
            position: absolute;
            top: 270px;     
            right: 100px;
            transition: background-image 0.1s ease;
            cursor: pointer;
        }
        /* css위치를 bottom으로 설정하면 애니메이션 동작안함 */
        #songBox1{
            background-image: url("./image/colorB.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 160px;
            height: 240px;
            position: absolute;
            bottom: 40px;
            left: 6px;
            cursor: pointer;
        }
        #songBox2{
            background-image: url("./image/colorP.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 160px;
            height: 240px;
            position: absolute;
            bottom: 128px;
            right: 80px;
            cursor: pointer;
        }
        #songBox3{
            background-image: url("./image/colorY.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 160px;
            height: 240px;
            position: absolute;
            top: 205px;
            left: 105px;
            cursor: pointer;
        }
        #songBox_closed1{
            background-image: url("./image/colorBClosed.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 170px;
            height: 256px;
            position: absolute;
            opacity: 0;
            bottom: 5%;
            left: 0;
        }
        #songBox_closed2{
            background-image: url("./image/colorPClosed.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 170px;
            height: 256px;
            position: absolute;
            opacity: 0;
            top: 45.6%;
            right: 15%;
        }
        #songBox_closed3{
            background-image: url("./image/colorYClosed.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 170px;
            height: 256px;
            position: absolute;
            opacity: 0;
            top: 27.7%;
            left: 20%;
        }
        .magae{
            background-image: url("./image/magae.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 62px;
            height: 75px;
            position: absolute;
        }
        #magae1{
            top: 52.5%;
            left: 11%;
            opacity: 0;
        }
        #magae2{
            top: 41%;
            right: 25.5%;
            opacity: 0;
        }
        #magae3{
            top: 22%;
            left: 31%;
            opacity: 0;
        }
        #singerBox_container{
            position: absolute;
            width: 500px;  
            height: 700px;
            top: 200px;
            left: 10px;
        }
        #songBox_container{
            position: absolute;
            width: 500px;  
            height: 700px;
            top: 200px;
            right: 10px;
        }
        #singer1{
            position: absolute;
            top: 10%;
            left: 32%;
            opacity: 0;
            transition: margin-top 1s;
        }
        
        
        #dropP1{
            background-image: url("./image/dropColorB1.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 303px;
            height: 260px;
            position: absolute;
            top: -184px;
            left: 210px;
            display: none;
        }
        #dropP2{
            background-image: url("./image/dropColorB2.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 300px;
            height: 250px;
            position: absolute;
            top: -142px;
            left: 170px;
            display: none;
        }
        #beaker_potion{
            position: absolute;
            bottom: 50px;
            width: 432px;
            height: 600px;
        }
        #beaker_border{
            background-image: url("./image/beakerBorder.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 450px;
            height: 550px;
            position: absolute;
            top: 8px;
            left: -10px;
            opacity: 0;
        }
        #beaker_shadow{
            background-image: url("./image/beakerShadow.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 500px;
            height: 250px;
            position: absolute;
            bottom: 0;
            left: -15px;
        }
        #player_container{
            font-family: 'Kyuri_diary', sans-serif;
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translate(-50%);
            width: 70%; 
            height: 55%;
            display: none;
        }
        #title_cover{
            display: flex;
            margin-inline: 53.146px;
            margin-bottom: 10.920px;
            align-items: center;
            justify-content: center;
            font-size: 25px;
        }
        #singer_cover{
            display: flex;
            margin-inline: 53.146px;
            margin-bottom: 19.920px;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        #current_bar{
            width: 80%;
            height: 5px;
            margin-inline: auto;
            border-radius: 5px;
            background-color: #D9D9D9;
            background-origin: border-box;
            background-clip: content-box, border-box;
        }
        #current_progress{
            margin-block: 10px;
            margin-inline: auto;
            display: flex;
            width: 80%;
            justify-content: space-between;
        }
        #button_container{
            width: 80%;
            margin-block: 30px;
            margin-inline: auto;
            display: flex;
            text-align: center;
            align-items: center;
            justify-content: center;
        }
        #current_song{
            margin: 0;
            color: #7BA4E1;
        }
        #current_singer{
            margin: 0;
            color: #A4A4A4;
        }
        #current_time{
            color: #D9D9D9;
            font-family: 'Inter';
            font-size: 15px;
        }
        #total_time{
            color: #D9D9D9;
            font-family: 'Inter';
            font-size: 15px;
        }
        #progressBar{
            background: #B6D2FF
        }
        .bubble {
            border-radius: 50%;
            background-color: #D6EFFF;
        }
        #bubble1{
            position: absolute;
            top: 480px;
            right: 216px;
            width: 24px;
            height: 24px;
            opacity: 0;
        }
        #bubble2{
            position: absolute;
            top: 457px;
            right: 150px;
            width: 15px;
            height: 15px;
        }
        #bubble3{
            position: absolute;
            top: 449px;
            right: 236px;
            width: 20px;
            height: 20px;
        }
        #bubble4{
            position: absolute;
            top: 440px;
            right: 180px;
            width: 15px;
            height: 15px;
        }
        #bubble5{
            position: absolute;
            top: 400px;
            right: 160px;
            width: 20px;
            height: 20px;
        }
        #bubble6{
            position: absolute;
            top: 400px;
            right: 70px;
            width: 23px;
            height: 23px;
        }
        #white_board{
            background-image: url("./image/playerBoard.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 800px;
            height: 490px;
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translate(-50%);
        }
        #play_button{
            cursor: pointer;
            margin-inline: 30px;
        }
        #back10_button{
            cursor: pointer;
        }
        #for10_button{
            cursor: pointer;
        }
        #progress_circle{
            position: absolute;
            transform: translate(-50%, -25%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #B6D2FF;
        }
        #songShadow1{
            background-image: url("./image/colorShadow.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 100px;
            height: 30px;
            position: absolute;
            bottom: 4.7%;
            left: 9.6%;
            transition: transform 0.3s;
        }
        #songShadow2{
            background-image: url("./image/colorShadow.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 100px;
            height: 30px;
            position: absolute;
            bottom: 122px;
            right: 97px;
            transition: transform 0.3s;
        }
        #songShadow3{
            background-image: url("./image/colorShadow.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 100px;
            height: 30px;
            position: absolute;
            bottom: 248px;
            left: 148px;
            transition: transform 0.3s;
        }
        #singerPlate1{
            background-image: url("./image/plate.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 200px;
            height: 130px;
            position: absolute;
            bottom: 50px;
            right: 0;
        }
        #singerPlate2{
            background-image: url("./image/plate.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 200px;
            height: 130px;
            position: absolute;
            bottom: 110px;
            left: 40px;
        }
        #singerPlate3{
            background-image: url("./image/plate.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: 200px;
            height: 130px;
            position: absolute;
            bottom: 210px;
            right: 60px;
        }
        #goBack_container{
            position: absolute;
            width: 200px;
            height: 20px;
            bottom: 0;
        }
        #big_goBack{
            background-image: url("./image/bigGoBack.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            width: inherit;
            height: inherit;
            display: none;
            /* display: flex; */
            justify-content: center;
        }
        #goBack_btn{
            background-image: url("./image/goBackBtn.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            position: absolute;
            width: 120px;
            height: 40px;
            bottom: 20px;
            /* left: 50%; */
        }
        #darkScreen{
            background-color: black;
            display: none;
            width: 100vw;
            height: 100vh;
            position: absolute;
            opacity: 0.3;
        }
        .full_screen {
            width: 100%;
            height: 100vh; 
            background-color: #D6E6F3; 
        }
        #mainbg{
            background-image: url("./image/main0.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            position: absolute;
            opacity: 1;
            transition: all 0.3s;
            top: 100%;
        }
        #enter1{
            width: 15%;
            height: 30%;
            position: absolute;
            top: 43%;
            left: 15%;
            /* opacity: 0.5;
            background-color: red; */
        }
        #enter2{
            width: 16%;
            height: 30%;
            position: absolute;
            top: 43%;
            left: 49%;
            transform: translate(-50%);
            /* opacity: 0.5;
            background-color: black; */
        }
        #enter3{
            width: 22%;
            height: 30%;
            position: absolute;
            top: 45%;
            right: 11%;
            /* opacity: 0.5;
            background-color: red; */
        }
        #hoverZone{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #down_container{
            position: absolute;
            bottom: 0;
            height: 50px;
        }
        #small_down{
            background-image: url("./image/smallDown.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            position: absolute;
            bottom: 40px;
            left: 50%;
            width: 100px;
            height: 30px;
            opacity: 1;
            transform: translate(-50%);
            transition: opacity 1s;
        }
        #big_down{
            background-image: url("./image/bigDown.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            position: absolute;
            bottom: 10px;
            left: 50%;
            width: 120px;
            height: 40px;
            opacity: 0;
            transform: translate(-50%);
            transition: opacity 1s;
        }
        #small_up{
            background-image: url("./image/smallUp.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            position: absolute;
            top: 200px;
            left: 50%;
            width: 100px;
            height: 30px;
            opacity: 1;
            transform: translate(-50%);
            transition: opacity 1s;
        }
        #big_up{
            background-image: url("./image/bigUp.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size : contain;
            position: absolute;
            top: 150px;
            left: 50%;
            width: 120px;
            height: 40px;
            opacity: 0;
            transform: translate(-50%);
            transition: opacity 1s;
        }
    </style>
</head>
<body>
    <div id="top_light">
        
    </div>
    <div id="white_board">
        <div id="player_container">
            <div id="title_cover">
                <h1 id="current_song">Title</h1>
            </div>
            <div id="singer_cover">
                <h2 id="current_singer">Singer</h1>
            </div>
            <div id="current_bar">
                <div id="progressBar" style="width: 0; height: 5px;">
                    <div id="progress_circle"></div>
                </div>
                
            </div>
            <div id="current_progress">
                <div id="current_time">
                    0:00
                </div>
                <div id="total_time">
                    3:00
                </div>
            </div>
            <div id="button_container">
                <img id="back10_button" src="./image/back10.png" alt="10초 뒤로 버튼" width="36px">
                <img id="play_button" src="./image/pauseBtn.png" alt="플레이 버튼" width="60px">
                <img id="for10_button" src="./image/for10.png" alt="10초 앞으로 버튼" width="36px">
            </div>
        </div>
    </div>
    <div id="beaker_potion">
        <div id="beaker_shadow"></div>
        <div id="beaker_border"></div>
        <div id="beaker_back" class="child absolute">
            <div class="beaker_container">
                <img id="singer1" src="./image/floatD.png" width="160px"/>
            </div>
        </div>
        <div id="beaker_cover" class="child absolute opac_5"></div>  <!-- 비커 안 물속에있는 효과 주기위한 커버이미지 -->
        <div id="bubble1" class="bubble"></div>
        <div id="bubble2" class="bubble"></div>
        <div id="bubble3" class="bubble"></div>
        <div id="bubble4" class="bubble"></div>
        <div id="bubble5" class="bubble"></div>
        <div id="bubble6" class="bubble"></div>
        <div id="dropP1"></div>
        <div id="dropP2"></div>
    </div>

    <div id="singerBox_container">
        <div id="singerPlate2"></div>
        <div id="singerPlate3"></div>
        <div id="singerPlate1"></div>
        <div id="singerBox2"></div>
        <div id="singerBox3"></div>
        <div id="singerBox1"></div>
    </div>

    <div id="songBox_container">
        <div id="songBox_closed3"></div>
        <div id="songBox_closed1"></div>
        <div id="songBox_closed2"></div>
        <div id="songShadow3"></div>
        <div id="songShadow1"></div>
        <div id="songShadow2"></div>
        <div id="songBox3"></div>
        <div id="songBox1"></div>
        <div id="songBox2"></div>
        <div id="magae3" class="magae"></div>
        <div id="magae1" class="magae"></div>
        <div id="magae2" class="magae"></div>
    </div>
    <!-- 메인화면으로 전환  -->
    <div id="darkScreen">
        <div id="small_up"></div>
        <div id="big_up"></div>
    </div>
    <div id="goBack_container">
        <div id="big_goBack">
            <div id="goBack_btn"></div>
        </div>
        <div id="down_container">
            <div id="small_down"></div>
            <div id="big_down"></div>
        </div>
    </div>
    <div id="mainbg" class="full_screen">
        <div id="hoverZone">
            <div id="enter1"></div>
            <div id="enter2"></div>
            <div id="enter3"></div>
        </div>
    </div>
    <!-- 메인화면으로 전환  -->

    
</body>
<script>
    $( function() {
        let bubbleIndex = 0
        
        let bubbleIndex2 = 1
        let bubbleIndex3 = 0
        let bubbleIndex4 = 0
        function bubblePop1 () { 
            setInterval(function () {
                bubbleIndex = ((bubbleIndex+1) % 2);
                if(bubbleIndex){
                    console.log("실행됨")
                    $('#bubble1').animate({'margin-top': -100}, 2000)
                }
                $('#bubble1').css('opacity', bubbleIndex)
                $('#bubble1').animate({'margin-top': 0}, 0)
            }, 600);
            setInterval(function () {
                bubbleIndex2 = ((bubbleIndex2+1) % 2);
                if(bubbleIndex2){
                    console.log("실행됨")
                    $('#bubble2').animate({'margin-top': -100}, 2000)
                }
                $('#bubble2').css('opacity', bubbleIndex2)
                $('#bubble2').animate({'margin-top': 0}, 0)
            }, 800);
            setInterval(function () {
                bubbleIndex = ((bubbleIndex+1) % 2);
                if(bubbleIndex){
                    console.log("실행됨")
                    $('#bubble3').animate({'margin-top': -100}, 2000)
                }
                $('#bubble3').css('opacity', bubbleIndex)
                $('#bubble3').animate({'margin-top': 0}, 0)
            }, 400);
            
            setInterval(function () {
                bubbleIndex = ((bubbleIndex+1) % 2);
                if(bubbleIndex){
                    console.log("실행됨")
                    $('#bubble4').animate({'margin-top': -60}, 2000)
                }
                $('#bubble4').css('opacity', bubbleIndex)
                $('#bubble4').animate({'margin-top': 0}, 0)
            }, 600);
            
            setInterval(function () {
                bubbleIndex = ((bubbleIndex+1) % 2);
                if(bubbleIndex){
                    console.log("실행됨")
                    $('#bubble5').animate({'margin-top': -50}, 2000)
                }
                $('#bubble5').css('opacity', bubbleIndex)
                $('#bubble5').animate({'margin-top': 0}, 0)
            }, 500);
            
            setInterval(function () {
                bubbleIndex = ((bubbleIndex+1) % 2);
                if(bubbleIndex){
                    console.log("실행됨")
                    $('#bubble6').animate({'margin-top': -50}, 2000)
                }
                $('#bubble6').css('opacity', bubbleIndex)
                $('#bubble6').animate({'margin-top': 0}, 0)
            }, 700);

        }
        bubblePop1()
        let downIndex = 0
        let upIndex = 0
        function changeDown () { 
            setInterval(function () {
                $('#small_down').css('opacity', downIndex)
                downIndex = ((downIndex+1) % 2);
                $('#big_down').css('opacity', downIndex)
            }, 1000);
        }
        function changeUP () { 
            setInterval(function () {
                $('#small_up').css('opacity', upIndex)
                upIndex = ((upIndex+1) % 2);
                $('#big_up').css('opacity', upIndex)
            }, 850);
        }
        changeDown();
        changeUP();
        $('#enter1').hover(function(){
            hoverSoundPlay(0)
            $("#mainbg").css("background-image", "url(./image/main1.png)");
        },function() {
            $("#mainbg").css("background-image", "url(./image/main0.png)");
        });
        $('#enter2').hover(function(){
            hoverSoundPlay(1)
            $("#mainbg").css("background-image", "url(./image/main2.png)");
        },function() {
            $("#mainbg").css("background-image", "url(./image/main0.png)");
        });
        $('#enter3').hover(function(){
            hoverSoundPlay(2)
            $("#mainbg").css("background-image", "url(./image/main3.png)");
        },function() {
            $("#mainbg").css("background-image", "url(./image/main0.png)");
        });


        // 버튼 이벤트
        $('#enter1').click(function(){ 
            window.location.href = 'beakerLab.html';
        })
        $('#enter2').click(function(){
            window.location.href = 'bodyLab.html';
        })
        $('#enter3').click(function(){
            window.location.href = 'paperLab.html';
        })

        // 현재 재생중인 오디오
        let currentEAudio = new Audio()
        let effectAudios = [
            {
                id: '1',
                sound: 'beakerHtml',
                audio: './musics/mainBeakerHoverSound.mp3'
            },
            {
                id: '2',
                sound: 'bodyHtml',
                audio: './musics/mainBodyHoverSound.mp3'
            },
            {
                id: '3',
                sound: 'paperHtml',
                audio: './musics/mainPaperHoverSound.mp3'
            }
        ]
        function hoverSoundPlay (index){
            if(index == 0){
                let audio   = new Audio(effectAudios[index].audio)
                currentEAudio.pause()
                currentEAudio = audio
                currentEAudio.currentTime = 0;
                currentEAudio.play()
            }
            else if(index == 1){
                let audio   = new Audio(effectAudios[index].audio)
                currentEAudio.pause()
                currentEAudio = audio
                currentEAudio.currentTime = 0;
                currentEAudio.play()
            }
            else if(index == 2){
                let audio   = new Audio(effectAudios[index].audio)
                currentEAudio.pause()
                currentEAudio = audio
                currentEAudio.currentTime = 0;
                currentEAudio.play()
            }
        }
        let goBackBtnHover = false
        function detectResize() {
            // 현재 윈도우 창의 너비와 높이 얻기
            let windowWidth = window.innerWidth ;
            let windowHeight = window.innerHeight ;
            
            goBackImgHeight = (136 * windowWidth)/1920
            $("#goBack_container").css("width", windowWidth+'px');
            $("#goBack_container").css("height", goBackImgHeight+'px');
            $("#down_container").css("width", windowWidth+'px');

            let standard = 9/16 // 기준 비율
            let nowRatio = Number((windowHeight/windowWidth).toFixed(4))    // 현재 비율
            let imgWidth;
            let imgHeight;
            if(nowRatio < standard){    // 현재 비율이 기준보다 작을때 
                imgWidth = (16 * windowHeight)/9
                imgHeight = windowHeight
                $("#hoverZone").css("width", imgWidth+'px');
                $("#hoverZone").css("height", imgHeight+'px');
            }
            else if(nowRatio > standard){
                imgHeight = (9 * windowWidth)/16
                imgWidth = windowWidth
                $("#hoverZone").css("width", imgWidth+'px');
                $("#hoverZone").css("height", imgHeight+'px');
            }


        }

        window.addEventListener('resize', detectResize);
        detectResize();

        $('#down_container').hover(function(){
            $('#down_container').css('display', 'none')
            $('#big_goBack').css('display', 'flex')
        },function() {
        });
        $('#big_goBack').hover(function(){
        },function() {
            $('#down_container').css('display', 'block')
            $('#big_goBack').css('display', 'none')
        });
        function addGoBackHover() {   // 제거했던 캐릭터 호버 이벤트 매핑해주는 역할
            $('#down_container').on({
                mouseenter: function() {
                    $('#down_container').css('display', 'none')
                    $('#big_goBack').css('display', 'flex')
                },
                mouseleave: function() {
                }
            });
            $('#big_goBack').on({
                mouseenter: function() {
                },
                mouseleave: function() {
                    $('#down_container').css('display', 'block')
                    $('#big_goBack').css('display', 'none')
                }
            });
        }

        let originalPosition0; 
        let originalPosition1;
        let originalPosition2;
        let originalPosition3;
        let originalPosition4;
        let originalPosition5;
        let originalPosition6;

        let waveIndex = 1;  // 현재 물결 이미지의 인덱스
        let color;
        let animationId;  // requestAnimationFrame의 반환 값
        let stopAnimationFlag = false;
        let globalColor = "blue"
        let isSingerIn = true;

        function makeWave(color = "blue") {
            globalColor = color;
            animate1()
        }

        function animate1() {
            requestAnimationFrame(animate1);
            waveIndex = ( parseInt((new Date()).getTime()/1000) % 4) + 1;  // 1, 2, 3, 4를 순환하도록 설정

            if (stopAnimationFlag) {    // requestAnimationFrame을 종료하는거시아니다! 그냥 리턴시키는것 뿐이다!
                // console.log("리턴됨!", globalColor)
                return;
            }
            // 색상에 따른 이미지 변경
            $("#beaker_back").css("background-image", "url(./image/plask_back_" + globalColor + waveIndex + ".png)");
            $("#beaker_cover").css("background-image", "url(./image/plask_" + globalColor + waveIndex + ".png)");
        }
        let up = true;
        let down = false;
        let now_margin;
        let moveIndex = 1;
        let stopSinger = false;
        function falling(){     // 비커 내부로 캐릭터 떨어지는 애니메이션 함수
            $('#singer1').css('transition', 'none');
            $("#singer1").animate({'margin-top': -200}, 0)      // 비커 안 캐릭터 보이기
            $("#singer1").css("opacity", "1")
            $("#singer1").animate({'margin-top': 20}, 200)
            $("#singer1").animate({'margin-top': -20}, 200)
            $("#singer1").animate({'margin-top': 5}, 200)
            $("#singer1").animate({'margin-top': -5}, 200)
            $("#singer1").animate({'margin-top': 0}, 200)
        }
        function flySinger(){   // 비커 밖으로 캐릭터 튕겨나가는 애니메이션 함수
            $('#singer1').css('transition', 'none');
            $("#singer1").animate({'margin-top': -5}, 100)
            $("#singer1").animate({'margin-top': 5}, 100)
            $("#singer1").animate({'margin-top': -10}, 100)
            $("#singer1").animate({'margin-top': 10}, 100)
            $("#singer1").animate({'margin-top': -15}, 100)
            $("#singer1").animate({'margin-top': 15}, 100)
            $("#singer1").animate({'margin-top': -20}, 100)
            $("#singer1").animate({'margin-top': 20}, 100)
            $("#singer1").animate({'margin-top': -200}, 200)      // 비커 안 캐릭터 보이기
        }
        function animate2() {   // 비커 안에서 둥둥 떠다니는 애니메이션
            requestAnimationFrame(animate2);
            moveIndex = ( parseInt((new Date()).getTime()/1000) % 2);  // 1초마다 moveIndex 값 0, 1 변경
            now_margin = $("#singer1").css('margin-top')
            if (stopSinger) {    // requestAnimationFrame을 종료하는거시아니다! 그냥 리턴시키는것 뿐이다!
                // console.log("싱어 리턴됨!")
                return;
            }
            if(moveIndex){
                $("#singer1").css('margin-top', -5)
            }
            else{
                $("#singer1").css('margin-top', 10)
            }
        }
        animate2();
        function stopSingerMove() {  // 사실 requestAnimationFrame을 종료하는거시 아니다! 그저 종료한것처럼 보이게 하는것 뿐이다!
            stopSinger = true;
        }
        // 애니메이션 종료
        function stopAnimation() {  // 사실 requestAnimationFrame을 종료하는거시 아니다! 그저 종료한것처럼 보이게 하는것 뿐이다!
            stopAnimationFlag = true;
        }
        makeWave();
        // ==============================================================================================

        function addHover() {   // 제거했던 호버 이벤트 매핑해주는 역할
            $('#songBox1').on({
                mouseenter: function() {
                    startHoverEffect("#songBox1");
                },
                mouseleave: function() {
                    stopHoverEffect("#songBox1");
                }
            });
            $('#songBox2').on({
                mouseenter: function() {
                    startHoverEffect("#songBox2");
                },
                mouseleave: function() {
                    stopHoverEffect("#songBox2");
                }
            });
            $('#songBox3').on({
                mouseenter: function() {
                    startHoverEffect("#songBox3");
                },
                mouseleave: function() {
                    stopHoverEffect("#songBox3");
                }
            });
        }
        function addSingerHover() {   // 제거했던 캐릭터 호버 이벤트 매핑해주는 역할
            $('#singerBox1').on({
                mouseenter: function() {
                    $(this).css("background-image", "url(./image/hoverD.png)");
                    startSingerHoverEffect("#singerBox1");
                },
                mouseleave: function() {
                    $(this).css("background-image", "url(./image/standD.png)");
                    stopSingerHoverEffect("#singerBox1");
                }
            });
            $('#singerBox2').on({
                mouseenter: function() {
                    $(this).css("background-image", "url(./image/hoverM.png)");
                    startSingerHoverEffect("#singerBox2");
                },
                mouseleave: function() {
                    $(this).css("background-image", "url(./image/standM.png)");
                    stopSingerHoverEffect("#singerBox2");
                }
            });
            $('#singerBox3').on({
                mouseenter: function() {
                    $(this).css("background-image", "url(./image/hoverR.png)");
                    startSingerHoverEffect("#singerBox3");
                },
                mouseleave: function() {
                    $(this).css("background-image", "url(./image/standR.png)");
                    stopSingerHoverEffect("#singerBox3");
                }
            });
        }

        // hover 효과 시작 함수
        function startHoverEffect(selector) {
            $(selector).data("hoverAnimation", true);   // 호버 중
            animateHoverEffect(selector);
        }

        // hover 효과 애니메이션 함수
        function animateHoverEffect(selector) {
            if ($(selector).data("hoverAnimation")) {   // 만약 마우스 호버 중이면~
                $(selector).animate({'rotate': '-5deg'}, 100, function() {
                    $(this).animate({'rotate': '5deg'}, 100, function() {
                        $(this).css({'rotate': '0deg'});
                        // 필요한 만큼 반복
                        animateHoverEffect(selector);
                    });
                });
            }
        }
        // hover 효과 정지 함수
        function stopHoverEffect(selector) {
            $(selector).data("hoverAnimation", false).stop('rotate', true).css({'rotate': '0deg'}); //호버 중이 아님을 기록하고, 회전애니메이션만 중지, 각도 원상태로
        }
        // ==============================================================================================

        // hover 효과 시작 함수
        function startSingerHoverEffect(selector) {
            $(selector).data("singerHover", true);   // 호버 중
            singerJumpEffect(selector);
        }
        
        // hover 효과 애니메이션 함수
        function singerJumpEffect(selector) {
            if ($(selector).data("singerHover")) {   // 만약 마우스 호버 중이면~
                $(selector).animate({'margin-top': -10}, 200, function() {
                    $(this).animate({'margin-top': 0}, 200, function() {
                        $(this).delay(200).css({'margin-top': 0});
                        // 반복
                        singerJumpEffect(selector);
                    });
                });
            }
        }
        
        // hover 효과 정지 함수
        function stopSingerHoverEffect(selector) {
            $(selector).data("singerHover", false).stop(true, true).css({'margin-top': 0}); //호버 중이 아님을 기록하고, 마진탑애니메이션만 중지, 마진탑 원상태로
        }
        $('#singerBox1').hover(function(){
            $(this).css("background-image", "url(./image/hoverD.png)");
            startSingerHoverEffect(this);
        },function() {
            $(this).css("background-image", "url(./image/standD.png)");
            stopSingerHoverEffect(this);
        });
        $('#singerBox2').hover(function(){
            $(this).css("background-image", "url(./image/hoverM.png)");
            startSingerHoverEffect(this);
        },function() {
            $(this).css("background-image", "url(./image/standM.png)");
            stopSingerHoverEffect(this);
        });
        $('#singerBox3').hover(function(){
            $(this).css("background-image", "url(./image/hoverR.png)");
            startSingerHoverEffect(this);
        },function() {
            $(this).css("background-image", "url(./image/standR.png)");
            stopSingerHoverEffect(this);
        });
        
        $("#songBox1, #songBox2, #songBox3").hover(function() {
            startHoverEffect(this);
        }, function() {
            stopHoverEffect(this);
        });
        let isTwo = false
        $('#beaker_cover').hover(function(){
            if(isTwo){
                $("#beaker_border").css("opacity", "1");
            }
        },function() {
            if(isTwo){
                $("#beaker_border").css("opacity", "0");
            }
        });

        function magaeClose1(){ //  물병 뚜껑 닫는 함수
            setTimeout(function(){
                $("#magae1").animate({'margin-top': -200}, 0)
                $("#magae1").css('opacity', '100')
                $("#magae1").animate({'margin-top': 0}, 200)
            }, 800)
            setTimeout(function(){
                $("#magae1").css('opacity', '0')
                $("#songBox1").css('display', 'none')
                $("#songShadow1").css('opacity', '0')
                $("#songBox_closed1").css('opacity', '1')
            }, 1000)
        }
        function magaeClose2(){
            setTimeout(function(){
                $("#magae2").animate({'margin-top': -200}, 0)
                $("#magae2").css('opacity', '100')
                $("#magae2").animate({'margin-top': 0}, 200)
            }, 800)
            setTimeout(function(){
                $("#magae2").css('opacity', '0')
                $("#songBox2").css('display', 'none')
                $("#songShadow2").css('opacity', '0')
                $("#songBox_closed2").css('opacity', '1')
            }, 1000)
        }
        function magaeClose3(){
            setTimeout(function(){
                $("#magae3").animate({'margin-top': -200}, 0)
                $("#magae3").css('opacity', '100')
                $("#magae3").animate({'margin-top': 0}, 200)
            }, 800)
            setTimeout(function(){
                $("#magae3").css('opacity', '0')
                $("#songBox3").css('display', 'none')
                $("#songShadow3").css('opacity', '0')
                $("#songBox_closed3").css('opacity', '1')
            }, 1000)
        }
        function magaeOpen1(){  // 물병 뚜껑 여는함수
            setTimeout(function(){
                $("#songBox1").css('display', 'block')
                $("#songBox_closed1").css('opacity', '0')
                $("#songShadow1").css('opacity', '1')
                $("#magae1").css('opacity', '100')
                $("#magae1").animate({'margin-top': -200}, 200)
            }, 400)
            setTimeout(function(){
                $("#magae1").css('opacity', '0')
            }, 600)
        }
        function magaeOpen2(){
            setTimeout(function(){
                $("#songBox2").css('display', 'block')
                $("#songBox_closed2").css('opacity', '0')
                $("#songShadow2").css('opacity', '1')
                $("#magae2").css('opacity', '100')
                $("#magae2").animate({'margin-top': -200}, 200)
            }, 500)
            setTimeout(function(){
                $("#magae2").css('opacity', '0')
            }, 700)
        }
        function magaeOpen3(){
            setTimeout(function(){
                $("#songBox3").css('display', 'block')
                $("#songBox_closed3").css('opacity', '0')
                $("#songShadow3").css('opacity', '1')
                $("#magae3").css('opacity', '100')
                $("#magae3").animate({'margin-top': -200}, 200)
            }, 300)
            setTimeout(function(){
                $("#magae3").css('opacity', '0')
            }, 500)
        }
        function startMainUp(e) {   // 뒤로가기 화살표 위치 감지해서 절반 넘어가면 메인페이지로 가게 하는 함수
            let y = e.pageY;
            let windowHeight = window.innerHeight ;
            let standard = windowHeight/2
            if(y <= standard){
                $("#small_up").css("background-image", "url(./image/smallUp2.png)");
                $("#big_up").css("background-image", "url(./image/bigUp2.png)");
                
                currentAudio.pause()
                setTimeout(function(){
                    $("#goBack_btn").css('opacity', '0')
                }, 100)
                setTimeout(function(){
                    $("#mainbg").css('top', 0)
                }, 700)
                
            }
        }
        $( "#goBack_btn" ).draggable({  // 뒤로가기 버튼 드래그 이벤트
            revert: "invalid",
            start: function(event, ui) {        // 뒤로가기 버튼 조작 시 다른 요소들 [드래그 금지, 호버 이벤트 금지]
                // 드래그를 시작할 때의 원래 위치 저장
                originalPosition0 = ui.helper.offset();     
                $("#singerBox1, #singerBox2, #singerBox3").draggable("option", "disabled", true);  
                $("#songBox1, #songBox2, #songBox3").draggable("option", "disabled", true);
                $("#singerBox1, #singerBox2, #singerBox3").off('mouseenter mouseleave');
                $('#songBox1, #songBox2, #songBox3').off('mouseenter mouseleave');
                $('#down_container, #big_goBack').off('mouseenter mouseleave');
                $("#darkScreen").css('display', 'block')
                $(document).on('mousemove', startMainUp);
            },
            stop: function(event, ui) {
                $(document).off('mousemove', startMainUp);
                // 드래그 종료시 원래 위치로 이동
                $(this).offset(originalPosition0);
                $("#singerBox1, #singerBox2, #singerBox3").draggable("option", "disabled", false);
                $("#songBox1, #songBox2, #songBox3").draggable("option", "disabled", false);
                addSingerHover()
                addHover()
                addGoBackHover()
                $('#down_container').css('display', 'block')
                $('#big_goBack').css('display', 'none')
                $("#darkScreen").css('display', 'none')
            }
        });
        $( "#singerBox1" ).draggable({  // 동물 캐릭터 드래그 이벤트
            revert: "invalid",
            start: function(event, ui) {
                stopSingerHoverEffect("#singerBox1");
                // 드래그를 시작할 때의 원래 위치 저장
                originalPosition1 = ui.helper.offset();
                $("#singerBox1, #singerBox2, #singerBox3").draggable("option", "disabled", true);
                $("#singerBox1, #singerBox2, #singerBox3").off('mouseenter mouseleave');
                
            },
            stop: function(event, ui) {
                // 드래그 종료시 원래 위치로 이동
                $(this).offset(originalPosition1);
                if ($(this).css('opacity') != '0'){
                    $(this).css("background-image", "url(./image/standD.png)");
                    $("#singerBox1, #singerBox2, #singerBox3").draggable("option", "disabled", false);
                    addSingerHover()
                }
                else if ($(this).css('opacity') == '0'){
                    setTimeout(function(){
                        $("#singerBox2, #singerBox3").css('transition','background-image 1s ease')
                        $("#singerBox2").css("background-image", "url(./image/deadM.png)");
                        $("#singerBox3").css("background-image", "url(./image/deadR.png)");
                    }, 200)
                }
            }
        });
        $( "#singerBox2" ).draggable({ 
            revert: "invalid",
            start: function(event, ui) {
                stopSingerHoverEffect("#singerBox2");
                originalPosition2 = ui.helper.offset();
                $("#singerBox1, #singerBox2, #singerBox3").draggable("option", "disabled", true);
                $("#singerBox1, #singerBox2, #singerBox3").off('mouseenter mouseleave');
            },
            stop: function(event, ui) {
                $(this).offset(originalPosition2);
                if ($(this).css('opacity') != '0'){
                    $(this).css("background-image", "url(./image/standM.png)");
                    $("#singerBox1, #singerBox2, #singerBox3").draggable("option", "disabled", false);
                    addSingerHover()
                }
                else if ($(this).css('opacity') == '0'){    // 드래그 불가 힌트용 이미지 변경
                    setTimeout(function(){
                        $("#singerBox1").css("background-image", "url(./image/deadD.png)");
                        $("#singerBox3").css("background-image", "url(./image/deadR.png)");
                    }, 200)
                }
            }
        });
        $( "#singerBox3" ).draggable({ 
            revert: "invalid",
            start: function(event, ui) {
                stopSingerHoverEffect("#singerBox3");
                originalPosition3 = ui.helper.offset();
                $("#singerBox1, #singerBox2, #singerBox3").draggable("option", "disabled", true);
                $("#singerBox1, #singerBox2, #singerBox3").off('mouseenter mouseleave');
            },
            stop: function(event, ui) {
                $(this).offset(originalPosition3);
                if ($(this).css('opacity') != '0'){
                    $(this).css("background-image", "url(./image/standR.png)");
                    $("#singerBox1, #singerBox2, #singerBox3").draggable("option", "disabled", false);
                    addSingerHover()
                }
                else if ($(this).css('opacity') == '0'){
                    setTimeout(function(){
                        $("#singerBox1").css("background-image", "url(./image/deadD.png)");
                        $("#singerBox2").css("background-image", "url(./image/deadM.png)");
                    }, 200)
                }
            }
        });

        $( "#songBox1" ).draggable({    // 물병 드래그 이벤트
            revert: "invalid",
            start: function(event, ui) {
                stopHoverEffect("#songBox1");
                originalPosition4 = ui.helper.offset();
                $("#songShadow1").css('transform', 'scale(0.2,0.2)')
                setTimeout(function(){
                    $("#songShadow1").css('opacity', '0')
                }, 300)
                $("#songBox1, #songBox2, #songBox3").draggable("option", "disabled", true);
                $('#songBox1, #songBox2, #songBox3').off('mouseenter mouseleave');
            },
            stop: function(event, ui) {
                $(this).offset(originalPosition4);
                if ($(this).css('opacity') != '0'){
                    $("#songBox1, #songBox2, #songBox3").draggable("option", "disabled", false);
                    addHover()
                    $("#songShadow1").css('opacity', '1')
                    $("#songShadow1").css('transform', 'scale(1, 1)')
                }
                else if ($(this).css('opacity') == '0'){
                    magaeClose2()
                    magaeClose3()

                }
            }
        });
        $( "#songBox2" ).draggable({
            revert: "invalid",
            start: function(event, ui) {
                stopHoverEffect("#songBox2");

                originalPosition5 = ui.helper.offset();
                $("#songShadow2").css('transform', 'scale(0.2,0.2)')
                setTimeout(function(){
                    $("#songShadow2").css('opacity', '0')
                }, 300)
                $("#songBox1, #songBox2, #songBox3").draggable("option", "disabled", true);
                $('#songBox1, #songBox2, #songBox3').off('mouseenter mouseleave');
            },
            stop: function(event, ui) {
                $(this).offset(originalPosition5);
                if ($(this).css('opacity') != '0'){
                    $("#songBox1, #songBox2, #songBox3").draggable("option", "disabled", false);
                    addHover()
                    $("#songShadow2").css('opacity', '1')
                    $("#songShadow2").css('transform', 'scale(1, 1)')
                }
                else if ($(this).css('opacity') == '0'){
                    magaeClose1()
                    magaeClose3()
                }
            }
        });
        $( "#songBox3" ).draggable({
            revert: "invalid",
            start: function(event, ui) {
                stopHoverEffect("#songBox3");

                originalPosition6 = ui.helper.offset();
                $("#songShadow3").css('transform', 'scale(0.2,0.2)')
                setTimeout(function(){
                    $("#songShadow3").css('opacity', '0')
                }, 300)
                $("#songBox1, #songBox2, #songBox3").draggable("option", "disabled", true);
                $('#songBox1, #songBox2, #songBox3').off('mouseenter mouseleave');
            },
            stop: function(event, ui) {
                $(this).offset(originalPosition6);
                if ($(this).css('opacity') != '0'){
                    $("#songBox1, #songBox2, #songBox3").draggable("option", "disabled", false);
                    addHover()
                    $("#songShadow3").css('opacity', '1')
                    $("#songShadow3").css('transform', 'scale(1, 1)')
                }
                else if ($(this).css('opacity') == '0'){
                    magaeClose1()
                    magaeClose2()
                }
            }
        });
        let singer_name
        let song_mood
        let firstTime = true    // 페이지 로드되고 플레이어 처음 생성될때(폰트 처음 불러와서 깨지는 느낌 방지용)

        $( "#beaker_cover" ).droppable({    // 비커에 드랍하는 요소 감지하고 처리하는 이벤트
            accept: "#singerBox1, #singerBox2, #singerBox3, #songBox1, #songBox2, #songBox3",
            drop: function( event, ui ) {
                // console.log(ui.draggable[0].id) // 드랍한 요소 id 확인
                if(ui.draggable[0].id == "singerBox1"){
                    $("#singerBox1").css("opacity", "0");
                    $("#singerBox1").css("background-image", "url(./image/standD.png)");
                    $("#singer1").attr("src", "./image/floatD.png");    // 비커 안에 캐릭터 이미지 변경 

                    stopSingerMove()    // 둥둥떠다니는거 잠시 멈춰(위에서 떨어지는 애니메이션 써야됨)
                    setTimeout(function(){
                        falling()   // 비커 내부로 캐릭터 떨궈지는 애니메이션 함수
                    }, 100)
                    setTimeout(function(){
                        $('#singer1').css('transition', 'margin-top 1s linear');    // 비커 안에서 둥둥떠다닐떄 트랜지션 리니어로 줌
                        stopSinger = false
                        animate2(); // 둥둥떠다니는 애니메이션 다시 실행
                    }, 1100)
                    singer_name = "dragon";
                }
                else if(ui.draggable[0].id == "singerBox2"){
                    $("#singerBox2").css("opacity", "0");
                    $("#singerBox2").css("background-image", "url(./image/standM.png)");
                    $("#singer1").attr("src", "./image/floatM.png");
                    
                    stopSingerMove()    // 둥둥떠다니는거 잠시 멈춰(위에서 떨어지는 애니메이션 써야됨)
                    setTimeout(function(){
                        falling()   // 비커 내부로 캐릭터 떨궈지는 애니메이션 함수
                    }, 100)
                    setTimeout(function(){
                        $('#singer1').css('transition', 'margin-top 1s linear');    // 비커 안에서 둥둥떠다닐떄 트랜지션 리니어로 줌
                        stopSinger = false
                        animate2(); // 둥둥떠다니는 애니메이션 다시 실행
                    }, 1100)

                    singer_name = "monkey";
                }
                else if(ui.draggable[0].id == "singerBox3"){
                    $("#singerBox3").css("opacity", "0");
                    $("#singerBox3").css("background-image", "url(./image/standR.png)");
                    $("#singer1").attr("src", "./image/floatR.png");
                    
                    stopSingerMove()    // 둥둥떠다니는거 잠시 멈춰(위에서 떨어지는 애니메이션 써야됨)
                    setTimeout(function(){
                        falling()   // 비커 내부로 캐릭터 떨궈지는 애니메이션 함수
                    }, 100)
                    setTimeout(function(){
                        $('#singer1').css('transition', 'margin-top 1s linear');    // 비커 안에서 둥둥떠다닐떄 트랜지션 리니어로 줌
                        stopSinger = false
                        animate2(); // 둥둥떠다니는 애니메이션 다시 실행
                    }, 1100)

                    singer_name = "rabbit";
                }
                if(ui.draggable[0].id == "songBox1"){   // 물병이 드랍됐을때
                    song_mood = "dark"
                    $( "#songBox1" ).css("opacity", "0");
                    $("#dropP1").css("background-image", "url(./image/dropColorB1.png)");
                    $("#dropP1").css("display", "block");
                    setTimeout(function(){
                        $("#dropP1").css("display", "none");
                        $("#dropP2").css("background-image", "url(./image/dropColorB2.png)");
                        $("#dropP2").css("display", "block");
                    }, 400)
                    stopAnimation()
                    setTimeout(function(){
                        stopAnimationFlag = false;
                        makeWave("black");
                        $(".bubble").css("background-color", "#A9B0B4");
                    }, 900)
                    setTimeout(function(){
                        $("#dropP2").css("display", "none");
                    }, 1000)

                }
                else if(ui.draggable[0].id == "songBox2"){
                    song_mood = "love"
                    $( "#songBox2" ).css("opacity", "0");
                    $("#dropP1").css("background-image", "url(./image/dropColorP1.png)");
                    $("#dropP1").css("display", "block");
                    setTimeout(function(){
                        $("#dropP1").css("display", "none");
                        $("#dropP2").css("background-image", "url(./image/dropColorP2.png)");
                        $("#dropP2").css("display", "block");
                    }, 400)
                    stopAnimation()
                    setTimeout(function(){
                        stopAnimationFlag = false;
                        makeWave("pink");
                        $(".bubble").css("background-color", "#FFDDE3");
                    }, 900)
                    setTimeout(function(){
                        $("#dropP2").css("display", "none");
                    }, 1000)
                }
                else if(ui.draggable[0].id == "songBox3"){
                    song_mood = "bright"
                    $( "#songBox3" ).css("opacity", "0");
                    $("#dropP1").css("background-image", "url(./image/dropColorY1.png)");
                    $("#dropP1").css("display", "block");
                    setTimeout(function(){
                        $("#dropP1").css("display", "none");
                        $("#dropP2").css("background-image", "url(./image/dropColorY2.png)");
                        $("#dropP2").css("display", "block");
                    }, 400)
                    stopAnimation()
                    setTimeout(function(){
                        stopAnimationFlag = false;
                        makeWave("yellow");
                        $(".bubble").css("background-color", "#FFF1C1");
                    }, 900)
                    setTimeout(function(){
                        $("#dropP2").css("display", "none");
                    }, 1000)
                }   // 가수 하나 색상 하나 선택하게 제한해야됨.
                let count = 0   
                for(let i = 1; i < 4; i++){     // 비커에 몇개 들어갔는지 확인하는 반복문 
                    let singer_id = "#singerBox" + i
                    let song_id = "#songBox" + i
                    if($(singer_id).css("opacity") == "0"){
                        count += 1
                    }
                    if($(song_id).css("opacity") == "0"){
                        count += 1
                    }
                }
                if(count == 2){ // 비커에 요소 두개가 들어와있으면 노래 재생
                    $("#beaker_cover").css("cursor", "pointer");
                    if(currentAudio.paused == true){$('#play_button').attr("src", "./image/pauseBtn.png");}
                    for(let i in audios){
                        if(audios[i].singerN == singer_name){
                            if(audios[i].songM == song_mood){
                                let audio   = new Audio(audios[i].audio)
                                let title   = audios[i].title
                                let author  = audios[i].author

                                $("#current_song").text(title);
                                $("#current_singer").text(author);

                                setTimeout(function(){
                                    if(firstTime){
                                        firstTime = false
                                        $("#player_container").css("opacity", "0");
                                        $("#player_container").css("display", "block");
                                        setTimeout(function(){
                                            console.log("실행됨")
                                            $("#player_container").css("opacity", "1");
                                        }, 100)
                                    }
                                    else{
                                        $("#player_container").css("display", "block");
                                    }

                                    currentAudio.pause()
                                    currentAudio = audio
                                    currentAudio.currentTime = 0;
                                    currentAudio.volume = 0.3;  // 음악 소리 30퍼센트로 조절
                                    currentAudio.play()
                                    $("#beaker_border").css("opacity", "1");
                                    isTwo = true    // 비커 호버이벤트 추가
                                    clickPossible = true    // 비커 안에 요소 두개 들어왔으니 이제 클릭 가능!
                                }, 1100)
                            }
                        }
                    }
                }
                
            }
        });
        function explodeSong() {    // 비커 내부 동물 흔들리며 사라지는 애니메이션, 비커 흔들리는 애니메이션
            flySinger()
            $("#beaker_back").animate({ rotate: '-10deg' }, 100).animate({ rotate: '10deg' }, 100).animate({ rotate: '-10deg' }, 100).animate({ rotate: '10deg' }, 100).animate({ rotate: '-10deg' }, 100).animate({ rotate: '10deg' }, 100).animate({ rotate: '-10deg' }, 100).animate({ rotate: '10deg' }, 100).animate({ rotate: '0deg' }, 50);
            $("#beaker_cover").animate({ rotate: '-10deg' }, 100).animate({ rotate: '10deg' }, 100).animate({ rotate: '-10deg' }, 100).animate({ rotate: '10deg' }, 100).animate({ rotate: '-10deg' }, 100).animate({ rotate: '10deg' }, 100).animate({ rotate: '-10deg' }, 100).animate({ rotate: '10deg' }, 100).animate({ rotate: '0deg' }, 50);
        }

        function runEffect() {  // 비커 클릭시 발생하는 이벤트들을 실행하는 함수

            stopAnimation()  // 비커 내부 물결 잠시 중지!!

            stopSingerMove()    // 둥둥떠다니는거 잠시 멈춰(위에서 떨어지는 애니메이션 써야됨)
            
            setTimeout(function(){  
                explodeSong()
            }, 500) 
            setTimeout(function(){  // 노래 종료, 플레이어 숨김
                $("#singer1").css("opacity", "0")
                currentAudio.pause()    
                $("#player_container").css("display", "none");
            }, 1500)    
            
            for(let i = 1; i < 4; i++){ 
                let singer_id = "#singerBox" + i
                let song_id = "#songBox" + i
                if($(singer_id).css("opacity") == "0"){ // 캐릭터 아이템 보충
                    setTimeout(function(){
                        stopAnimationFlag = false;
                        makeWave();
                        $(".bubble").css("background-color", "#D6EFFF");
                        $(singer_id).animate({'margin-top': -200}, 0)
                        $(singer_id).css("opacity", "100")
                        $(singer_id).animate({'margin-top': 0}, 200)
                    }, 1700)
                }
                if($(song_id).css("opacity") == "0"){   // 물병 아이템 보충
                    setTimeout(function(){
                        $(song_id).animate({'margin-top': -200}, 0)
                        $(song_id).css("opacity", "100")
                        $(song_id).animate({'margin-top': 0}, 200)
                        if(song_id == "#songBox1"){
                            $("#songShadow1").css('opacity', '1')
                            $("#songShadow1").css('transform', 'scale(1, 1)')
                            magaeOpen2()
                            magaeOpen3()
                        }
                        else if(song_id == "#songBox2"){
                            $("#songShadow2").css('opacity', '1')
                            $("#songShadow2").css('transform', 'scale(1, 1)')
                            magaeOpen1()
                            magaeOpen3()
                        }
                        else if(song_id == "#songBox3"){
                            $("#songShadow3").css('opacity', '1')
                            $("#songShadow3").css('transform', 'scale(1, 1)')
                            magaeOpen1()
                            magaeOpen2()
                        }
                    }, 1700)
                }
            }
            setTimeout(function(){  // 비커에 들어갔던 캐릭터가 다시 돌아오게 되면 드래그 불가 해제
                $("#singerBox1, #singerBox2, #singerBox3, #songBox1, #songBox2, #songBox3").draggable("option", "disabled", false);
                $("#singerBox1").css("background-image", "url(./image/standD.png)");
                $("#singerBox2").css("background-image", "url(./image/standM.png)");
                $("#singerBox3").css("background-image", "url(./image/standR.png)");
                addHover()
                addSingerHover()
            }, 2000)    // 드래그 불가시간 넉넉하게 2초로 둠
            setTimeout(function(){  // 트랜지션 시간 조정
                $("#singerBox1, #singerBox2, #singerBox3").css('transition','background-image 0.1s ease')
            }, 3000)   
            
        };

    

        let clickPossible = false
        $( "#beaker_cover" ).on( "click", function() {  // 비커 클릭시 이벤트
            if(clickPossible){
                clickPossible = false   // 비커 요소들을 모두 비웠으니 이제 비커 클릭 불가능!
                isTwo = false   // 호버도 안됨~
                $("#beaker_border").css("opacity", "0")
                $("#beaker_cover").css("cursor", "default");
                runEffect();

            }
            else if(!clickPossible){
                console.log("차단됨!!")
            }
            
            
        });

        let playerDisplay = false
        // 현재 재생중인 오디오
        let currentAudio = new Audio()

        let audios = [
            {
                singerN: 'dragon',
                songM: 'dark',
                audio: './musics/GDragon  무제無題 Untitled.mp3',
                title: '무제',
                author: 'G-DRAGON'
            },
            {
                singerN: 'dragon',
                songM: 'love',
                audio: './musics/GDragon 삐딱하게.mp3',
                title: '삐딱하게',
                author: 'G-DRAGON'
            },
            {
                singerN: 'dragon',
                songM: 'bright',
                audio: './musics/GDragon Crayon 크레용.mp3',
                title: 'Crayon 크레용',
                author: 'G-DRAGON'
            },
            {
                singerN: 'monkey',
                songM: 'dark',
                audio: './musics/잔나비 - 주저하는 연인들을 위해.mp3',
                title: '주저하는 연인들을 위해',
                author: '잔나비'
            },
            {
                singerN: 'monkey',
                songM: 'love',
                audio: './musics/잔나비 - 사랑하긴 했었나요.mp3',
                title: '사랑하긴 했었나요',
                author: '잔나비'
            },
            {
                singerN: 'monkey',
                songM: 'bright',
                audio: './musics/잔나비 - 알록달록.mp3',
                title: '알록달록',
                author: '잔나비'
            },
            {
                singerN: 'rabbit',
                songM: 'dark',
                audio: './musics/NewJeans - Ditto.mp3',
                title: 'Ditto',
                author: 'NewJeans'
            },
            {
                singerN: 'rabbit',
                songM: 'love',
                audio: './musics/NewJeans - Super Shy.mp3',
                title: 'Super Shy',
                author: 'NewJeans'
            },
            {
                singerN: 'rabbit',
                songM: 'bright',
                audio: './musics/NewJeans - Hype Boy.mp3',
                title: 'Hype Boy',
                author: 'NewJeans'
            }
        ]
        // 현재 시간 얻기
        setInterval(function(){
            let minutes = Math.floor(currentAudio.currentTime / 60);
            let seconds = Math.floor(currentAudio.currentTime % 60);
            let timeString = minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
            $('#current_time').text(timeString);
            minutes = Math.floor(currentAudio.duration / 60);
            seconds = Math.floor(currentAudio.duration % 60);
            timeString = minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
            $('#total_time').text(timeString);

            if($('#current_time').text() == $('#total_time').text()){
                setTimeout(function(){
                    currentAudio.currentTime = 0
                    $('#play_button').attr("src", "./image/playBtn.png");
                }, 1000)
            }

            let barWidth = $('#current_bar').innerWidth();
            $('#current_bar > div').css('width', barWidth * currentAudio.currentTime / currentAudio.duration )
            
            $('#current_bar > div > div').css('left', (Number($('#current_bar').css('margin-left').slice(0,-2)) + Number($('#current_bar > div').css('width').slice(0,-2))) + 'px')
        }, 50)

        // 버튼 이벤트
        $('#play_button').click(function(){ // 재생/일시정지
            if(currentAudio.paused == true){
                currentAudio.play()
                $('#play_button').attr("src", "./image/pauseBtn.png");
                
            }
            else{
                currentAudio.pause()
                $('#play_button').attr("src", "./image/playBtn.png");
            }
        })
        $('#for10_button').click(function(){
            currentAudio.currentTime += 10
        })
        $('#back10_button').click(function(){
            currentAudio.currentTime -= 10
        })
        

    });
    
    


    
</script>
</html>